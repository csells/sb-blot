<!--
Date: 3/5/2004 11:50:10 AM  -08:00
Permalink: 1172
Disqus: 1172
Tags: tools
-->
<h1>Reimplementing Mike's cmdline Utility using WMI</h1>
<a href="http://www.bearcanyon.com/tools/">Here</a>. <P>In early 2000, Mike Woodring moved Heaven and Earth to write a tool that would inject a DLL into a process's memory for purposes of finding the command line with which the process was launched. While hanging around Don and Tim this week, Don was all hot on WMI, so we fired it up in .NET and rebuilt Mike's tool like so:</P>
<P class=MsoNormal><FONT face="Courier New" color=blue size=2><SPAN style="FONT-SIZE: 10pt; COLOR: blue; FONT-FAMILY: 'Courier New'">using</SPAN></FONT><FONT face="Courier New" size=2><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'"> System;<BR></SPAN></FONT><FONT face="Courier New" color=blue size=2><SPAN style="FONT-SIZE: 10pt; COLOR: blue; FONT-FAMILY: 'Courier New'">using</SPAN></FONT><FONT face="Courier New" size=2><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'"> System.Management;<BR></SPAN></FONT><FONT face="Courier New" color=blue size=2><SPAN style="FONT-SIZE: 10pt; COLOR: blue; FONT-FAMILY: 'Courier New'"><FONT color=#000000><BR></FONT>class</SPAN></FONT><FONT face="Courier New" size=2><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'"> cmdline {<BR></SPAN></FONT><FONT face="Courier New" size=2><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp; <FONT color=blue><SPAN style="COLOR: blue">static</SPAN></FONT> <FONT color=blue><SPAN style="COLOR: blue">void</SPAN></FONT> <?xml:namespace prefix = st1 ns = "urn:schemas-microsoft-com:office:smarttags" /><st1:place w:st="on">Main</st1:place>(<FONT color=blue><SPAN style="COLOR: blue">string</SPAN></FONT>[] args) {<BR></SPAN></FONT><FONT face="Courier New" size=2><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp; <FONT color=blue><SPAN style="COLOR: blue">if</SPAN></FONT>( args.Length != 1 ) {<BR></SPAN></FONT><FONT face="Courier New" size=2><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine("usage: cmdline &lt;processId&gt;");<BR></SPAN></FONT><FONT face="Courier New" size=2><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=blue><SPAN style="COLOR: blue">return</SPAN></FONT>;<BR></SPAN></FONT><FONT face="Courier New" size=2><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp; }<BR><BR></SPAN></FONT><FONT face="Courier New" size=2><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp; ManagementObject obj =<BR></SPAN></FONT><FONT face="Courier New" size=2><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=blue><SPAN style="COLOR: blue">new</SPAN></FONT> ManagementObject(<FONT color=blue><SPAN style="COLOR: blue">string</SPAN></FONT>.Format("Win32_Process.Handle=\"{0}\"", args[0]));<BR></SPAN></FONT><FONT face="Courier New" size=2><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp; Console.WriteLine(obj.Properties["CommandLine"].Value);<BR></SPAN></FONT><FONT face="Courier New" size=2><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp; }<BR></SPAN></FONT><FONT face="Courier New" size=2><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">}</SPAN></FONT></P>
<P>This makes WMI pretty darn cool in my book. I'll be reading Jon Fancey's article on WMI + .NET in <A href="http://msdn.microsoft.com/msdnmag/issues/04/04/default.aspx">the latest MSDN Magazine</A>.</P>
<P>BTW, I have to admit that I'm nowhere near as manly as Mike. I'll take this sissy code any day. : )</P>
