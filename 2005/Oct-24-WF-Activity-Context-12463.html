<!--
Date: 10/24/2005 12:00:00 AM  -08:00
Permalink: 12463
Disqus: 12463
Tags: spout
-->
<h1>WF Activity Context</h1>
<p align="left">I was playing around with a state machine workflow in WF and ran across something that I didn't except. Apparently if you have a an activity that can be other than a singleton, e.g. inside of a loop or as part of a state machine workflow, then an activity can not be accessed by it's workflow instance variable. For example, the following works just fine in a sequence workflow:</p><div align="left">
<pre><span style="COLOR: blue">public</span> <span style="COLOR: blue">partial</span> <span style="COLOR: blue">class</span> Workflow2 : SequentialWorkflow {
<span style="COLOR: blue">private</span> <span style="COLOR: blue">void</span> code1_ExecuteCode(<span style="COLOR: blue">object</span> sender, EventArgs e) {
<span style="COLOR: green">// Retrieve Comment property from typed event sink (generated by wca)</span>
string comment = <b>this.eventSink1.Comment</b>;
    Console.WriteLine(<span style="COLOR: maroon">&quot;Order approved w/ comment= {0}&quot;</span>, comment);
  }
}</pre></div><p align="left">However, in the case where the activity can be executed more than once, it's my understand that each time through, there's a new activity object that's different from the named activity associated with the workflow. To get a hold of the current activity, you have to traverse the activity tree, which you can access in a code activity via the sender's parent property:</p><div align="left">
<pre><span style="COLOR: blue">public</span> <span style="COLOR: blue">partial</span> <span style="COLOR: blue">class</span> StateMachine1 : StateMachineWorkflow {
<span style="COLOR: blue">void</span> code2_ExecuteCode(<span style="COLOR: blue">object</span> sender, EventArgs e) {
<span style="COLOR: green">// Retrieve Comment property from typed event sink (generated by wca)</span>
<b>    Code codeActivity = (Code)sender;
    IOrderService_Events.OrderApproved eventSink2 =
      (IOrderService_Events.OrderApproved)(codeActivity.Parent.Activities[<span style="COLOR: maroon">&quot;eventSink1&quot;</span>]);
</b>    <span style="COLOR: blue">string</span> comment = <b>eventSink2.Comment; <span style="COLOR: green">// eventSink1.Comment will be unbound</span>
</b>    Console.WriteLine(<span style="COLOR: maroon">&quot;order approved w/ comment= {0}&quot;</span>, comment);
  }
}</pre></div><p align="left">I haven't figured out whether this makes sense to me yet, but that's how it is. You can get the code <a href="/public/samples/WfEventSinkAndMethodInvoke2with3projectsAndStateMachine.zip">here</a>.</p>
