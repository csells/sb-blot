<!--
Date: 10/6/2006 10:14:57 AM  -08:00
Permalink: 2047
Disqus: 2047
Tags: .net
-->
<h1>WPF: Enabling Crimes Against Nature in a Good Way</h1>
<P>My friend Jeff asked me to do a terrible thing yesterday: "How do I show a form in the popup window that a menu shows?" I said, "Dude! Don't do that -- write a dialog!" And that's what he did, but then, like a train wreck, I couldn't look away. It took me all of 10 minutes of very straight forward coding and here we are:</P><IMG src="/public/samples/PopdownWindowSample.JPG"> 
<P>If you're familiar with WPF, data binding and data templates, this is all standard stuff. Here's the data structure:</P><PRE>class Person : INotifyPropertyChanged<BR>{<BR>&nbsp;&nbsp;&nbsp; string name;<BR>&nbsp;&nbsp;&nbsp; public string Name<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return name; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { name = value; Notify("Name"); }<BR>&nbsp;&nbsp;&nbsp; }</PRE><PRE>&nbsp;&nbsp;&nbsp; int age;<BR>&nbsp;&nbsp;&nbsp; public int Age<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return age; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set { age = value; Notify("Age"); }<BR>&nbsp;&nbsp;&nbsp; }</PRE><PRE>&nbsp;&nbsp;&nbsp; public event PropertyChangedEventHandler PropertyChanged;<BR>&nbsp;&nbsp;&nbsp; void Notify(string prop) {
    if( PropertyChanged != null ) {
        PropertyChanged(this, new PropertyChangedEventArgs(prop));
    }
}<BR>}</PRE>
<P>The data template is also bog standard:</P><PRE>&lt;DataTemplate DataType="{x:Type local:Person}"&gt;<BR>&nbsp; &lt;Grid&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;Grid.RowDefinitions&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;RowDefinition Height="auto" /&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;RowDefinition Height="auto" /&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;/Grid.RowDefinitions&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;Grid.ColumnDefinitions&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;ColumnDefinition Width="auto" /&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;ColumnDefinition Width="auto" /&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;/Grid.ColumnDefinitions&gt;</PRE><PRE>&nbsp;&nbsp;&nbsp; &lt;Label Grid.Row="0" Grid.Column="0"&gt;_Name&lt;/Label&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;TextBox Grid.Row="0" Grid.Column="1" Text="{Binding Name}" /&gt;</PRE><PRE>&nbsp;&nbsp;&nbsp; &lt;Label Grid.Row="1" Grid.Column="0"&gt;_Age&lt;/Label&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;TextBox Grid.Row="1" Grid.Column="1" Text="{Binding Age}" /&gt;<BR>&nbsp; &lt;/Grid&gt;<BR>&lt;/DataTemplate&gt;</PRE>
<P>Setting up the app itself is nothing special:</P><PRE>&lt;Window ...&gt;<BR>&nbsp; &lt;Window.Resources&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;DataTemplate DataType="{x:Type local:Person}"&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<BR>&nbsp;&nbsp;&nbsp; &lt;/DataTemplate&gt;<BR>&nbsp; &lt;/Window.Resources&gt;<BR>&nbsp; &lt;Grid&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;Menu&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;MenuItem Header="File"&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;MenuItem Header="Exit" x:Name="fileExitMenuItem" /&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/MenuItem&gt;<BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;MenuItem Header="Form" ItemsSource="{Binding}" /&gt;<BR></STRONG>&nbsp;&nbsp;&nbsp; &lt;/Menu&gt;<BR>&nbsp; &lt;/Grid&gt;<BR>&lt;/Window&gt;</PRE>
<P>Notice that the items that make up the menu come from a binding to the ambient data source, which we set in the code-behind:</P><PRE>protected override void OnInitialized(EventArgs e)<BR>{<BR>&nbsp;&nbsp;&nbsp; ...</PRE><PRE>&nbsp;&nbsp;&nbsp; Person tom = new Person();<BR>&nbsp;&nbsp;&nbsp; tom.Name = "Tom";<BR>&nbsp;&nbsp;&nbsp; tom.Age = 11;</PRE><PRE><STRONG>&nbsp;&nbsp;&nbsp; DataContext = new Person[] { tom };<BR></STRONG>}<BR></PRE>
<P>The only thing at all tricky is that, even though we're only editing a single object in the "popdown window," it has to be in an implementation of IEnumerable so that the menu can display it (it expects items to come in a list).</P>
<P>That's it. You can <A HREF="/public/samples/PopdownWindowSample.zip">download the RC1 WPF project here</A>.</P>
<P>You might wonder why I would post such a sample, when clearly that's not a UI we want to foster on folks. The answer is simple: because WPF allows it.</P>
<P>The power of any platform should be judged by how well it lets you write bad code. Early versions of Visual Basic let you write really bad code -- but it worked. Likewise, WPF lets me build the worst UIs ever -- but they work. This is necessary so that UI visionaries can experiment and get to a place where they're doing something completely different from UIs of today and we <EM>like it.</EM></P>
<P>Do you think the Office folks, who, for all practical purposes, have&nbsp;been setting UI guidelines on Windows for a decade, could use MFC or Windows Forms? No, because they're not flexible enough. Could they use WPF? Absolutely they could. And so can you.</P>
<P>The crayon box has lots of colors that I don't like, but in the hands of an artist, they can create beauty.</P>
