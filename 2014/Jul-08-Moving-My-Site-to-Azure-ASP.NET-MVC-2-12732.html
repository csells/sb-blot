<!--
Date: 7/8/2014 7:36:57 PM  -08:00
Permalink: 12732
Disqus: 12732
Tags: spout
-->
<h1>Moving My Site to Azure: ASP.NET MVC 2</h1>
<p>In our last episode, I talked about <a href="/12731">the joy and wonder that is moving my site’s ISP-hosted SQL Server instance to SQL Azure</a>. Once I had the data moved over and the site flipped to using the new database, I needed to move the site itself over, which brought joy and wonder all it’s own.</p>  <h2>Moving to Visual Studio 2013</h2>  <p>I haven’t had to do any <a href="/12670">major updates to my site since 2010 using Visual Studio 2010</a>. At that time, the state of the art was ASP.NET MVC 2 and Entity Framework 4, which is what I used. And the combination was a pleasant experience, letting me rebuild my site from scratch quickly and producing a site that ran like the wind. In fact, it still runs like the wind. Unfortunately, Visual Studio 2012 stopped supporting MVC 2 (and no surprise, Visual Studio 2013 didn’t add MVC 2 support back). When I tried to load my web site project into Visual Studio 2013, it complained:</p>  <p><a href="/public/post-images/12732-214.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/public/post-images/12732-215.png" width="644" height="324" /></a></p>  <p><em>This version of Visual Studio is unable to open the following projects</em></p>  <p>&#160;</p>  <p>This error message lets me know that there’s a problem and the migration report provides a handy link to <a href="http://www.asp.net/whitepapers/mvc3-release-notes#upgrading">upgrade from MVC 2 to MVC 3</a>. The steps aren’t too bad and there’s even a tool to help, but had I followed them, loading the new MVC 3 version of my project into Visual Studio 2013 would’ve given me another error with another migration report and a link to <a href="http://www.asp.net/whitepapers/mvc4-release-notes#_Toc303253806">another web page, this time helping me move from MVC 3 to MVC 4</a> because VS2013 doesn’t support MVC 3, either. And so now I’m thinking, halfway up to my elbows in the move to MVC 3 that Visual Studio 2013 doesn’t like, that maybe there’s another way.</p>  <p>It’s not that there aren’t benefits to move to MVC 4, but that’s not even the latest version. In fact, Microsoft is currently working on two versions of ASP.NET, <a href="http://www.asp.net/mvc/tutorials/mvc-5/introduction/getting-started">ASP.NET MVC 5</a> and <a href="http://www.asp.net/vnext">ASP.NET v.Next</a>. <em>Even if I do move my site forward two version of MVC, I’ll still be two versions behind.</em> Of course, the new versions have new tools and new features and can walk my dog for me, but by dropping old versions on the floor, I’d left with the choices of running old versions of Visual Studio side-by-side with new ones, upgrading to new versions of MVC just to run the latest version of VS (even if I don’t need any of the new MVC features) or saying “screw it” and just re-writing my web site from scratch. This last option might seem like what Microsoft wants me to do so that they can stop supporting the old versions of MVC, but what’s to stop me from moving to AWS, Linux and Node instead of to ASP.NET v.Next? The real danger of dropping the old versions on the floor; not that I’ll move over to another platform, because I’m an Microsoft fanboy and my MSDN Subscription gives me the OS and the tools for free, but that large paying customers say “screw it” and move their web sites to something that their tools are going to support for more than a few years.</p>  <p>Luckily for me, there is another way: I can cheat. It turns out that if I want to load my MVC 2 project inside of Visual Studio 2013, all I have to do is remove a GUID from the csproj file inside the ProjectTypeGuids element. The GUID in question is listed on step 9 of <a href="http://www.asp.net/whitepapers/mvc3-release-notes#upgrading">Microsoft’s guide for upgrading from MVC 2 to MVC 3</a>:</p>  <p><a href="/public/post-images/12732-216.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/public/post-images/12732-217.png" width="644" height="411" /></a></p>  <p><em>Removing {F85E285D-A4E0-4152-9332-AB1D724D3325} from your MVC 2 project so it will load in Visual Studio 2013</em></p>  <p>&#160;</p>  <p>By removing this GUID, I give up some of the productivity tools inside Visual Studio, like easily adding a new controller. However, I’m familiar enough with MVC 2 that I no longer need those tools and being able to actually load my project into the latest version of Visual Studio is more than worth it. Andrew Steele provides more details about this hack in <a href="http://stackoverflow.com/questions/13424079/how-do-i-open-an-old-mvc-project-in-visual-studio-2012-or-visual-studio-2013/13424080#13424080">his most excellent StackOverflow post</a>.</p>  <p>Now, to get my MVC 2 project to actually build and run, I needed a copy of the MVC 2 assemblies, which I got from NuGet:</p>  <p><a href="/public/post-images/12732-218.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/public/post-images/12732-219.png" width="644" height="365" /></a></p>  <p><em>Adding the MVC 2 NuGet package to my project inside Visual Studio 2013</em></p>  <p>&#160;</p>  <p>With these changes, I could build my MVC 2 project inside Visual Studio 2013 and run on my local box against my SQL Azure instance. Now I just need to get it up on Azure.</p>  <h2>Moving to Azure</h2>  <p>Publishing my MVC 2 site to Azure was matter of right-clicking on my project and choosing the Publish option:</p>  <p><a href="/public/post-images/12732-220.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/public/post-images/12732-221.png" width="616" height="484" /></a></p>  <p><em>Publishing a web site to Azure using the Solution Explorer’s Publish option inside Visual Studio 2013</em></p>  <p>&#160;</p>  <p>Selecting the Windows Azure Web Sites as the target and filling in the appropriate credentials was all it took to get my site running on Azure. I did some battle with the “<a href="http://stackoverflow.com/questions/9300927/error-to-use-a-section-registered-as-allowdefinition-machinetoapplication-beyo">Error to use a section registered as allowDefinition='MachineToApplication' beyond application level</a>” bug in Visual Studio, but the only real issue I had was that Azure seemed to need the “Precompile during publishing” option set or it wasn’t able to run my MVC 2 views when I surfed to them:</p>  <p>&#160;</p>  <p><a href="/public/post-images/12732-222.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/public/post-images/12732-223.png" width="616" height="484" /></a></p>  <p><em>Setting the “Precompile during publishing” option for Azure to run my MVC 2 views</em></p>  <p>&#160;</p>  <p>With that setting in place, my Azure site just ran at the Azure URL I had requested: <a href="http://sellsbrothers.azurewebsites.net">http://sellsbrothers.azurewebsites.net</a>. </p>  <h2>Where are we?</h2>  <p>I’m a fan of <a href="http://www.asp.net/vnext/overview/aspnet-vnext/getting-started-with-aspnet-vnext-and-visual-studio">the direction of ASP.NET v.Next</a>. The order of magnitude reduction in working set, the open source development and the use of NuGet to designate pieces of the framework that you want are all great things. My objection is that I don’t want to be forced to move forward to new versions of a framework if I don’t need the features. If I am forced, then that’s just churn in working code that’s bound to introduce bugs.</p>  <p align="left"><a href="/12733">Tune in next time</a> and we’ll discuss the fun I had configuring the DNS settings to make Azure the destination for sellsbrothers.com and to add SSL to enable secure login for posting articles via AtomPub and Windows Live Writer.</p>  
